<Window x:Class="PromptBox.Views.WorkflowEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Workflow Editor" 
        Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{materialDesign:MaterialDesignFont}">
    
    <materialDesign:DialogHost Identifier="WorkflowEditorDialog">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Workflow Info -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="WORKFLOW DETAILS" 
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                       Margin="0,0,0,8"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="WorkflowNameBox"
                         Grid.Column="0"
                         materialDesign:HintAssist.Hint="Workflow Name"
                         Margin="0,0,8,0"
                         Foreground="{DynamicResource MaterialDesignBody}"/>
                <TextBox x:Name="WorkflowCategoryBox"
                         Grid.Column="1"
                         materialDesign:HintAssist.Hint="Category (e.g., Development, Writing)"
                         Margin="8,0,0,0"
                         Foreground="{DynamicResource MaterialDesignBody}"/>
            </Grid>
            <TextBox x:Name="WorkflowDescriptionBox"
                     materialDesign:HintAssist.Hint="Description"
                     Margin="0,8,0,0"
                     Foreground="{DynamicResource MaterialDesignBody}"/>
        </StackPanel>
        
        <!-- Steps Header -->
        <Grid Grid.Row="1" Margin="0,16,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="WORKFLOW STEPS" 
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                       VerticalAlignment="Center"/>
            <Button Grid.Column="1"
                    Content="Add Step"
                    Click="AddStep_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Height="28"
                    FontSize="12"/>
        </Grid>
        
        <!-- Steps List -->
        <Border Grid.Row="2" 
                BorderBrush="{DynamicResource MaterialDesignDivider}" 
                BorderThickness="1" 
                CornerRadius="4">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="StepsList" Margin="8">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource MaterialDesignCardBackground}" 
                                    CornerRadius="4" 
                                    Margin="0,4" 
                                    Padding="12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Step Header -->
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <Border Grid.Column="0" 
                                                Background="{DynamicResource PrimaryHueMidBrush}" 
                                                CornerRadius="12" 
                                                Width="24" Height="24"
                                                Margin="0,0,8,0">
                                            <TextBlock Text="{Binding Order}" 
                                                       Foreground="White" 
                                                       HorizontalAlignment="Center" 
                                                       VerticalAlignment="Center"
                                                       FontSize="12"/>
                                        </Border>
                                        
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                 materialDesign:HintAssist.Hint="Step Name"
                                                 Margin="0,0,8,0"
                                                 Foreground="{DynamicResource MaterialDesignBody}"/>
                                        
                                        <Button Grid.Column="2"
                                                Content="{materialDesign:PackIcon Kind=ArrowUp}"
                                                Click="MoveStepUp_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Width="28" Height="28"
                                                ToolTip="Move Up"/>
                                        <Button Grid.Column="3"
                                                Content="{materialDesign:PackIcon Kind=ArrowDown}"
                                                Click="MoveStepDown_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Width="28" Height="28"
                                                ToolTip="Move Down"/>
                                        <Button Grid.Column="4"
                                                Content="{materialDesign:PackIcon Kind=Delete}"
                                                Click="DeleteStep_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Foreground="#D32F2F"
                                                Width="28" Height="28"
                                                ToolTip="Delete Step"/>
                                    </Grid>
                                    
                                    <!-- Step Description -->
                                    <TextBox Grid.Row="1"
                                             Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="Step Description (optional)"
                                             Margin="32,8,0,0"
                                             Foreground="{DynamicResource MaterialDesignBody}"/>
                                    
                                    <!-- Prompt Template -->
                                    <Border Grid.Row="2" 
                                            BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                            BorderThickness="1" 
                                            CornerRadius="4"
                                            Margin="32,8,0,0">
                                        <TextBox Text="{Binding PromptTemplate, UpdateSourceTrigger=PropertyChanged}"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 MinHeight="80"
                                                 MaxHeight="150"
                                                 VerticalScrollBarVisibility="Auto"
                                                 Padding="8"
                                                 FontFamily="Consolas"
                                                 FontSize="12"
                                                 BorderThickness="0"
                                                 materialDesign:HintAssist.Hint="Prompt template. Use {{input}} for initial input, {{previous_output}} for previous step output, {{step1}}, {{step2}} etc."
                                                 Foreground="{DynamicResource MaterialDesignBody}"
                                                 Background="Transparent"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
        
        <!-- Footer Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Cancel"
                    Click="Cancel_Click"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Margin="0,0,8,0"/>
            <Button x:Name="SaveButton"
                    Content="Save Workflow"
                    Click="Save_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>
        </StackPanel>
    </Grid>
    </materialDesign:DialogHost>
</Window>
