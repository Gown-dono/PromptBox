<Window x:Class="PromptBox.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:PromptBox.Controls"
        Title="PromptBox - AI Prompt Manager" 
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{materialDesign:MaterialDesignFont}"
        Icon="/Assets/icon.ico">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Controls/MarkdownViewer.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <Style TargetType="TextBlock" x:Key="SectionHeader">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Margin" Value="0,10,0,5"/>
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            </Style>
            
            <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            </Style>
            
            <Style TargetType="TextBox" BasedOn="{StaticResource MaterialDesignTextBox}">
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            </Style>
            
            <Style TargetType="ListBox" BasedOn="{StaticResource MaterialDesignListBox}">
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <materialDesign:DialogHost Identifier="RootDialog">
        <Grid>
            <!-- Main Content -->
            <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar -->
            <Border Grid.Column="0" Background="{DynamicResource MaterialDesignCardBackground}" 
                    BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">
                        <Button Content="New Prompt" 
                                Command="{Binding NewPromptCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,6"/>
                        
                        <Button Content="Browse Library"
                                Command="{Binding BrowseLibraryCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,6"/>
                        
                        <Button Content="AI Prompt Builder"
                                Command="{Binding OpenPromptBuilderCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,6"/>
                        
                        <Button Content="Workflows"
                                Command="{Binding OpenWorkflowsCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,8"
                                ToolTip="Run multi-step prompt workflows (Code Development, Review, Documentation, etc.)"/>
                        
                        <Button Content="Batch Processing"
                                Command="{Binding OpenBatchProcessingCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,6"
                                ToolTip="Execute multiple prompts sequentially against selected AI models"/>
                        
                        <Button Content="Prompt Testing"
                                Command="{Binding OpenPromptTestingCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,6"
                                ToolTip="Test prompts with evaluation criteria and A/B comparison"/>
                        
                        <Button Content="Compare Prompts"
                                Command="{Binding OpenPromptComparisonCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,0,0,16"
                                ToolTip="Compare 2-4 prompt variations side-by-side across multiple models"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="CATEGORIES" Style="{StaticResource SectionHeader}"/>
                            <Button Grid.Column="1" 
                                    Content="Clear" 
                                    Command="{Binding ClearCategoryFilterCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Padding="4,0"
                                    Height="24"
                                    FontSize="11"
                                    VerticalAlignment="Center"/>
                        </Grid>
                        <ListBox ItemsSource="{Binding Categories}" 
                                 SelectedItem="{Binding SelectedCategory}"
                                 Margin="0,0,0,20"
                                 MaxHeight="150"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Foreground="{DynamicResource MaterialDesignBody}"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="TAGS" Style="{StaticResource SectionHeader}"/>
                            <Button Grid.Column="1" 
                                    Content="Clear" 
                                    Command="{Binding ClearTagFilterCommand}"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Padding="4,0"
                                    Height="24"
                                    FontSize="11"
                                    VerticalAlignment="Center"/>
                        </Grid>
                        <ListBox ItemsSource="{Binding Tags}" 
                                 SelectedItem="{Binding SelectedTag}"
                                 MaxHeight="200"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Tag" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{DynamicResource MaterialDesignBody}"/>
                                        <TextBlock Text="{Binding}" Foreground="{DynamicResource MaterialDesignBody}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Separator Margin="0,20"/>

                        <Button Content="Settings"
                                Command="{Binding OpenSettingsCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                materialDesign:ButtonAssist.CornerRadius="4"
                                Height="32"
                                FontSize="12"
                                Margin="0,5">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Cog" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <TextBlock Text="Settings" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Middle Panel - Prompt List -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Search Bar -->
                <TextBox Grid.Row="0" 
                         Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                         materialDesign:HintAssist.Hint="Search prompts..."
                         materialDesign:TextFieldAssist.HasLeadingIcon="True"
                         materialDesign:TextFieldAssist.LeadingIcon="Magnify"
                         Foreground="{DynamicResource MaterialDesignBody}"
                         Margin="16,16,16,8"/>

                <!-- Prompt List -->
                <ListBox Grid.Row="1" 
                         ItemsSource="{Binding FilteredPrompts}"
                         SelectedItem="{Binding SelectedPrompt}"
                         Margin="16,8,16,16"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12" Margin="0,4">
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}" 
                                               FontWeight="SemiBold" 
                                               FontSize="14"
                                               TextTrimming="CharacterEllipsis"
                                               Foreground="{DynamicResource MaterialDesignBody}"/>
                                    <TextBlock Text="{Binding Category}" 
                                               FontSize="12" 
                                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                                               Margin="0,2,0,0"/>
                                    <ItemsControl ItemsSource="{Binding Tags}" Margin="0,4,0,0">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource PrimaryHueMidBrush}" 
                                                        CornerRadius="3" 
                                                        Padding="6,2" 
                                                        Margin="0,0,4,4">
                                                    <TextBlock Text="{Binding}" 
                                                               FontSize="10" 
                                                               Foreground="White"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    <TextBlock Text="{Binding UpdatedDate, StringFormat='Updated: {0:MMM dd, yyyy}'}" 
                                               FontSize="11" 
                                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                                               Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>

            <!-- Right Panel - Editor -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Editor Header -->
                <StackPanel Grid.Row="0" Margin="16,16,16,8">
                    <TextBox Text="{Binding EditTitle, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Prompt Title"
                             FontSize="18"
                             FontWeight="SemiBold"
                             Foreground="{DynamicResource MaterialDesignBody}"
                             Margin="0,0,0,8"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Grid.Column="0"
                                 Text="{Binding EditCategory, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Category"
                                 Foreground="{DynamicResource MaterialDesignBody}"
                                 Margin="0,0,8,0"/>
                        
                        <TextBox Grid.Column="1"
                                 Text="{Binding EditTags, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Tags (comma-separated)"
                                 Foreground="{DynamicResource MaterialDesignBody}"
                                 Margin="8,0,0,0"/>
                    </Grid>
                </StackPanel>

                <!-- Editor Content -->
                <Grid Grid.Row="1" Margin="16,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Markdown Editor -->
                    <Border Grid.Column="0" 
                            BorderBrush="{DynamicResource MaterialDesignDivider}" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Background="{DynamicResource MaterialDesignCardBackground}">
                        <Grid>
                            <TextBox Text="{Binding EditContent, UpdateSourceTrigger=PropertyChanged}"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     VerticalScrollBarVisibility="Auto"
                                     materialDesign:HintAssist.Hint="Write your prompt here (Markdown supported)..."
                                     Padding="12"
                                     FontFamily="Consolas"
                                     FontSize="13"
                                     Foreground="{DynamicResource MaterialDesignBody}"
                                     Background="Transparent"
                                     BorderThickness="0"/>
                        </Grid>
                    </Border>

                    <GridSplitter Grid.Column="1" 
                                  HorizontalAlignment="Stretch" 
                                  Background="{DynamicResource MaterialDesignDivider}"/>

                    <!-- Markdown Preview -->
                    <Border Grid.Column="2" 
                            BorderBrush="{DynamicResource MaterialDesignDivider}" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Background="{DynamicResource MaterialDesignCardBackground}">
                        <local:MarkdownViewer Markdown="{Binding EditContent}" 
                                              Background="Transparent"/>
                    </Border>
                </Grid>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="16" HorizontalAlignment="Right">
                    <Button Command="{Binding ViewHistoryCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            ToolTip="View version history"
                            Margin="0,0,8,0">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="History" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="History"/>
                        </StackPanel>
                    </Button>
                    <Button Content="Copy to Clipboard" 
                            Command="{Binding CopyToClipboardCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="0,0,8,0"/>
                    <Button Content="Export as MD" 
                            Command="{Binding ExportAsMarkdownCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="0,0,8,0"/>
                    <Button Content="Export as TXT" 
                            Command="{Binding ExportAsTextCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="0,0,8,0"/>
                    <Button Content="Delete" 
                            Command="{Binding DeletePromptCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#D32F2F"
                            BorderBrush="#D32F2F"
                            Margin="0,0,8,0"/>
                    <Button Content="Save" 
                            Command="{Binding SavePromptCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                </StackPanel>
            </Grid>
        </Grid>
        
        <!-- Snackbar for notifications -->
        <materialDesign:Snackbar MessageQueue="{materialDesign:MessageQueue}" 
                                 x:Name="MainSnackbar"/>
        </Grid>
    </materialDesign:DialogHost>
</Window>
