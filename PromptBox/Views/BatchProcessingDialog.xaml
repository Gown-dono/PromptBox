<Window
    x:Class="PromptBox.Views.BatchProcessingDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Batch Processing"
    Width="1400"
    Height="900"
    WindowStartupLocation="CenterOwner"
    Background="{DynamicResource MaterialDesignPaper}"
    TextElement.Foreground="{DynamicResource MaterialDesignBody}">
    
    <materialDesign:DialogHost Identifier="BatchDialog">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,16">
                <TextBlock Text="Execute multiple prompts sequentially against selected AI models" 
                           FontSize="12" Opacity="0.7"/>
            </StackPanel>
            
            <!-- Main Content -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="280"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Left Panel: Prompt Selection -->
                <Border Grid.Column="0" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="8" Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Select Prompts" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        
                        <TextBox Grid.Row="1" x:Name="PromptSearchBox" 
                                 materialDesign:HintAssist.Hint="Search prompts..."
                                 TextChanged="PromptSearchBox_TextChanged"
                                 Margin="0,0,0,8"/>
                        
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,8">
                            <Button Content="Select All" Click="SelectAllPrompts_Click" 
                                    Style="{StaticResource MaterialDesignFlatButton}" Padding="8,4"/>
                            <Button Content="Clear All" Click="ClearAllPrompts_Click" 
                                    Style="{StaticResource MaterialDesignFlatButton}" Padding="8,4"/>
                        </StackPanel>
                        
                        <ListBox Grid.Row="3" x:Name="PromptsListBox" 
                                 SelectionMode="Multiple"
                                 VirtualizingPanel.IsVirtualizing="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                              Content="{Binding Title}"
                                              ToolTip="{Binding Category}"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
                
                <!-- Middle Panel: Model Selection & Settings -->
                <Border Grid.Column="2" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="8" Padding="12">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock Text="Select Models" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            
                            <ListBox x:Name="ModelsListBox" MaxHeight="200" Margin="0,0,0,16">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                  ToolTip="{Binding Description}">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding Provider}" FontSize="10" Opacity="0.7"/>
                                            </StackPanel>
                                        </CheckBox>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <Separator Margin="0,0,0,16"/>
                            
                            <TextBlock Text="Settings" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            
                            <TextBox x:Name="BatchNameBox" 
                                     materialDesign:HintAssist.Hint="Batch Name"
                                     Margin="0,0,0,8"/>
                            
                            <TextBox x:Name="BatchDescriptionBox" 
                                     materialDesign:HintAssist.Hint="Description (optional)"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     Height="60"
                                     Margin="0,0,0,16"/>
                            
                            <TextBlock Text="Temperature" Margin="0,0,0,4"/>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <Slider x:Name="TemperatureSlider" Minimum="0" Maximum="1" Value="0.7" 
                                        TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                                <TextBlock Grid.Column="1" x:Name="TemperatureValue" Text="0.7" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <TextBlock Text="Max Tokens" Margin="0,0,0,4"/>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="50"/>
                                </Grid.ColumnDefinitions>
                                <Slider x:Name="MaxTokensSlider" Minimum="256" Maximum="8192" Value="2048" 
                                        TickFrequency="256" IsSnapToTickEnabled="True"/>
                                <TextBlock Grid.Column="1" x:Name="MaxTokensValue" Text="2048" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                
                <!-- Right Panel: Progress & Results -->
                <Border Grid.Column="4" Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="8" Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Progress Section -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,16">
                            <TextBlock Text="Progress" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            
                            <ProgressBar x:Name="OverallProgressBar" Height="8" Minimum="0" Maximum="100" Value="0" Margin="0,0,0,8"/>
                            
                            <TextBlock x:Name="ProgressText" Text="Ready to start" Opacity="0.7" Margin="0,0,0,4"/>
                            <TextBlock x:Name="CurrentOperationText" Text="" FontSize="12" Opacity="0.6"/>
                        </StackPanel>
                        
                        <!-- Statistics -->
                        <UniformGrid Grid.Row="1" Rows="1" Margin="0,0,0,8">
                            <Border Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="4" Padding="8,4" Margin="0,0,4,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Total:" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                    <TextBlock x:Name="TotalCountText" Text="0" FontSize="14" FontWeight="Bold"
                                               Foreground="{DynamicResource MaterialDesignBody}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="4" Padding="8,4" Margin="4,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Success:" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                    <TextBlock x:Name="SuccessCountText" Text="0" FontSize="14" FontWeight="Bold" Foreground="LightGreen" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="4" Padding="8,4" Margin="4,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Failed:" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                    <TextBlock x:Name="FailedCountText" Text="0" FontSize="14" FontWeight="Bold" Foreground="#F44336" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{DynamicResource MaterialDesignCardBackground}" CornerRadius="4" Padding="8,4" Margin="4,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Tokens:" FontSize="11" Foreground="{DynamicResource MaterialDesignBodyLight}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                    <TextBlock x:Name="TokensCountText" Text="0" FontSize="14" FontWeight="Bold"
                                               Foreground="{DynamicResource MaterialDesignBody}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>
                        
                        <!-- Results -->
                        <Grid Grid.Row="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Results" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            
                            <DataGrid Grid.Row="1" x:Name="ResultsDataGrid" 
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      CanUserAddRows="False"
                                      CanUserDeleteRows="False"
                                      SelectionMode="Single"
                                      MouseDoubleClick="ResultsDataGrid_MouseDoubleClick"
                                      VirtualizingPanel.IsVirtualizing="True"
                                      VirtualizingPanel.VirtualizationMode="Recycling"
                                      EnableRowVirtualization="True"
                                      EnableColumnVirtualization="True">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="Status" Width="50">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <materialDesign:PackIcon Kind="{Binding StatusIcon}" 
                                                                         Foreground="{Binding StatusColor}"
                                                                         Width="20" Height="20"
                                                                         HorizontalAlignment="Center"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Prompt" Binding="{Binding PromptTitle}" Width="150"/>
                                    <DataGridTextColumn Header="Model" Binding="{Binding ModelName}" Width="120"/>
                                    <DataGridTextColumn Header="Tokens" Binding="{Binding TokensUsed}" Width="60"/>
                                    <DataGridTextColumn Header="Duration" Binding="{Binding DurationFormatted}" Width="70"/>
                                    <DataGridTextColumn Header="Response" Binding="{Binding ResponsePreview}" Width="*"/>
                                </DataGrid.Columns>
                                
                                <DataGrid.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Copy Response" Click="CopyResponse_Click"/>
                                        <MenuItem Header="View Full Response" Click="ViewFullResponse_Click"/>
                                        <Separator/>
                                        <MenuItem x:Name="RetryFailedMenuItem" Header="Retry Failed" Click="RetryFailed_Click"/>
                                    </ContextMenu>
                                </DataGrid.ContextMenu>
                            </DataGrid>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Footer -->
            <Grid Grid.Row="2" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock x:Name="StatusText" Text="Select prompts and models to begin" 
                           VerticalAlignment="Center" Opacity="0.7"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="StartButton" Content="Start Batch" Click="StartBatch_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            materialDesign:ButtonAssist.CornerRadius="4"
                            Margin="0,0,8,0"/>
                    <Button x:Name="PauseButton" Content="Pause" Click="PauseBatch_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            IsEnabled="False"
                            Margin="0,0,8,0"/>
                    <Button x:Name="CancelButton" Content="Cancel" Click="CancelBatch_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            IsEnabled="False"
                            Margin="0,0,8,0"/>
                    <Button x:Name="ExportButton" Content="Export Results" Click="ExportResults_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            IsEnabled="False"
                            ToolTip="Export results as CSV or JSON with full response data."
                            Margin="0,0,8,0"/>
                    <Button Content="Close" Click="Close_Click"
                            Style="{StaticResource MaterialDesignFlatButton}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>
